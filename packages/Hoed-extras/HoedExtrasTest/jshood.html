
<!doctype html>
<html>
<head>
  <title>JsHood</title>

  <style type="text/css">
    body {
      font: 10pt sans;
    }
    #network {
      width: 800px;
      height: 500px;
      border: 1px solid lightgray;
    }
  </style>

  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet" type="text/css" />

  <script type="text/javascript">
    var playIntervalID;
    var playspeed = 1;
    var nodes = null;
    var edges = null;
    var nodesArray = [];
    var edgesArray = [];
    
    var network = null;
    var layoutMethod = "directed";

    var events = ["{\"jsId\":3,\"jsType\":\"JsNew\",\"jsChildren\":[{\"jsChildId\":13,\"jsChildType\":\"JsInput\"},{\"jsChildId\":5,\"jsChildType\":\"JsOutput\"}],\"jsParent\":{\"jsParentId\":1,\"jsParentType\":\"JsOutput\"},\"jsLabel\":\"isOddEven\"}","{\"jsId\":5,\"jsType\":\"JsUpd\",\"jsChildren\":[{\"jsChildId\":79,\"jsChildType\":\"JsInput\"},{\"jsChildId\":142,\"jsChildType\":\"JsOutput\"}],\"jsParent\":{\"jsParentId\":3,\"jsParentType\":\"JsOutput\"},\"jsLabel\":\",\"}","{\"jsId\":9,\"jsType\":\"JsNew\",\"jsChildren\":[{\"jsChildId\":14,\"jsChildType\":\"JsInput\"},{\"jsChildId\":78,\"jsChildType\":\"JsOutput\"}],\"jsParent\":{\"jsParentId\":3,\"jsParentType\":\"JsCall\"},\"jsLabel\":\"isOdd\"}","{\"jsId\":13,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":3,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"5\"}","{\"jsId\":14,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":9,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"5\"}","{\"jsId\":17,\"jsType\":\"JsNew\",\"jsChildren\":[{\"jsChildId\":34,\"jsChildType\":\"JsInput\"},{\"jsChildId\":77,\"jsChildType\":\"JsOutput\"}],\"jsParent\":{\"jsParentId\":9,\"jsParentType\":\"JsCall\"},\"jsLabel\":\"isEven\"}","{\"jsId\":22,\"jsType\":\"JsNew\",\"jsChildren\":[{\"jsChildId\":27,\"jsChildType\":\"JsInput\"},{\"jsChildId\":32,\"jsChildType\":\"JsInput\"},{\"jsChildId\":33,\"jsChildType\":\"JsOutput\"}],\"jsParent\":{\"jsParentId\":9,\"jsParentType\":\"JsCall\"},\"jsLabel\":\"minus\"}","{\"jsId\":27,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":22,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"5\"}","{\"jsId\":29,\"jsType\":\"JsNew\",\"jsChildren\":[{\"jsChildId\":31,\"jsChildType\":\"JsOutput\"}],\"jsParent\":{\"jsParentId\":9,\"jsParentType\":\"JsCall\"},\"jsLabel\":\"one\"}","{\"jsId\":31,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":29,\"jsParentType\":\"JsOutput\"},\"jsLabel\":\"1\"}","{\"jsId\":32,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":24,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"1\"}","{\"jsId\":33,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":24,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"4\"}","{\"jsId\":34,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":17,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"4\"}","{\"jsId\":35,\"jsType\":\"JsNew\",\"jsChildren\":[{\"jsChildId\":47,\"jsChildType\":\"JsInput\"},{\"jsChildId\":76,\"jsChildType\":\"JsOutput\"}],\"jsParent\":{\"jsParentId\":17,\"jsParentType\":\"JsCall\"},\"jsLabel\":\"isOdd\"}","{\"jsId\":38,\"jsType\":\"JsNew\",\"jsChildren\":[{\"jsChildId\":43,\"jsChildType\":\"JsInput\"},{\"jsChildId\":45,\"jsChildType\":\"JsInput\"},{\"jsChildId\":46,\"jsChildType\":\"JsOutput\"}],\"jsParent\":{\"jsParentId\":17,\"jsParentType\":\"JsCall\"},\"jsLabel\":\"minus\"}","{\"jsId\":43,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":38,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"4\"}","{\"jsId\":45,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":40,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"1\"}","{\"jsId\":46,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":40,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"3\"}","{\"jsId\":47,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":35,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"3\"}","{\"jsId\":48,\"jsType\":\"JsNew\",\"jsChildren\":[{\"jsChildId\":60,\"jsChildType\":\"JsInput\"},{\"jsChildId\":75,\"jsChildType\":\"JsOutput\"}],\"jsParent\":{\"jsParentId\":35,\"jsParentType\":\"JsCall\"},\"jsLabel\":\"isEven\"}","{\"jsId\":51,\"jsType\":\"JsNew\",\"jsChildren\":[{\"jsChildId\":56,\"jsChildType\":\"JsInput\"},{\"jsChildId\":58,\"jsChildType\":\"JsInput\"},{\"jsChildId\":59,\"jsChildType\":\"JsOutput\"}],\"jsParent\":{\"jsParentId\":35,\"jsParentType\":\"JsCall\"},\"jsLabel\":\"minus\"}","{\"jsId\":56,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":51,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"3\"}","{\"jsId\":58,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":53,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"1\"}","{\"jsId\":59,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":53,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"2\"}","{\"jsId\":60,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":48,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"2\"}","{\"jsId\":61,\"jsType\":\"JsNew\",\"jsChildren\":[{\"jsChildId\":73,\"jsChildType\":\"JsInput\"},{\"jsChildId\":74,\"jsChildType\":\"JsOutput\"}],\"jsParent\":{\"jsParentId\":48,\"jsParentType\":\"JsCall\"},\"jsLabel\":\"isOdd\"}","{\"jsId\":64,\"jsType\":\"JsNew\",\"jsChildren\":[{\"jsChildId\":69,\"jsChildType\":\"JsInput\"},{\"jsChildId\":71,\"jsChildType\":\"JsInput\"},{\"jsChildId\":72,\"jsChildType\":\"JsOutput\"}],\"jsParent\":{\"jsParentId\":48,\"jsParentType\":\"JsCall\"},\"jsLabel\":\"minus\"}","{\"jsId\":69,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":64,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"2\"}","{\"jsId\":71,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":66,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"1\"}","{\"jsId\":72,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":66,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"1\"}","{\"jsId\":73,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":61,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"1\"}","{\"jsId\":74,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":61,\"jsParentType\":\"JsOutput\"},\"jsLabel\":\"True\"}","{\"jsId\":75,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":48,\"jsParentType\":\"JsOutput\"},\"jsLabel\":\"True\"}","{\"jsId\":76,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":35,\"jsParentType\":\"JsOutput\"},\"jsLabel\":\"True\"}","{\"jsId\":77,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":17,\"jsParentType\":\"JsOutput\"},\"jsLabel\":\"True\"}","{\"jsId\":78,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":9,\"jsParentType\":\"JsOutput\"},\"jsLabel\":\"True\"}","{\"jsId\":79,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":5,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"True\"}","{\"jsId\":81,\"jsType\":\"JsNew\",\"jsChildren\":[{\"jsChildId\":84,\"jsChildType\":\"JsInput\"},{\"jsChildId\":141,\"jsChildType\":\"JsOutput\"}],\"jsParent\":{\"jsParentId\":3,\"jsParentType\":\"JsCall\"},\"jsLabel\":\"isEven\"}","{\"jsId\":84,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":81,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"5\"}","{\"jsId\":85,\"jsType\":\"JsNew\",\"jsChildren\":[{\"jsChildId\":97,\"jsChildType\":\"JsInput\"},{\"jsChildId\":140,\"jsChildType\":\"JsOutput\"}],\"jsParent\":{\"jsParentId\":81,\"jsParentType\":\"JsCall\"},\"jsLabel\":\"isOdd\"}","{\"jsId\":88,\"jsType\":\"JsNew\",\"jsChildren\":[{\"jsChildId\":93,\"jsChildType\":\"JsInput\"},{\"jsChildId\":95,\"jsChildType\":\"JsInput\"},{\"jsChildId\":96,\"jsChildType\":\"JsOutput\"}],\"jsParent\":{\"jsParentId\":81,\"jsParentType\":\"JsCall\"},\"jsLabel\":\"minus\"}","{\"jsId\":93,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":88,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"5\"}","{\"jsId\":95,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":90,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"1\"}","{\"jsId\":96,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":90,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"4\"}","{\"jsId\":97,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":85,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"4\"}","{\"jsId\":98,\"jsType\":\"JsNew\",\"jsChildren\":[{\"jsChildId\":110,\"jsChildType\":\"JsInput\"},{\"jsChildId\":139,\"jsChildType\":\"JsOutput\"}],\"jsParent\":{\"jsParentId\":85,\"jsParentType\":\"JsCall\"},\"jsLabel\":\"isEven\"}","{\"jsId\":101,\"jsType\":\"JsNew\",\"jsChildren\":[{\"jsChildId\":106,\"jsChildType\":\"JsInput\"},{\"jsChildId\":108,\"jsChildType\":\"JsInput\"},{\"jsChildId\":109,\"jsChildType\":\"JsOutput\"}],\"jsParent\":{\"jsParentId\":85,\"jsParentType\":\"JsCall\"},\"jsLabel\":\"minus\"}","{\"jsId\":106,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":101,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"4\"}","{\"jsId\":108,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":103,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"1\"}","{\"jsId\":109,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":103,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"3\"}","{\"jsId\":110,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":98,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"3\"}","{\"jsId\":111,\"jsType\":\"JsNew\",\"jsChildren\":[{\"jsChildId\":123,\"jsChildType\":\"JsInput\"},{\"jsChildId\":138,\"jsChildType\":\"JsOutput\"}],\"jsParent\":{\"jsParentId\":98,\"jsParentType\":\"JsCall\"},\"jsLabel\":\"isOdd\"}","{\"jsId\":114,\"jsType\":\"JsNew\",\"jsChildren\":[{\"jsChildId\":119,\"jsChildType\":\"JsInput\"},{\"jsChildId\":121,\"jsChildType\":\"JsInput\"},{\"jsChildId\":122,\"jsChildType\":\"JsOutput\"}],\"jsParent\":{\"jsParentId\":98,\"jsParentType\":\"JsCall\"},\"jsLabel\":\"minus\"}","{\"jsId\":119,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":114,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"3\"}","{\"jsId\":121,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":116,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"1\"}","{\"jsId\":122,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":116,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"2\"}","{\"jsId\":123,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":111,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"2\"}","{\"jsId\":124,\"jsType\":\"JsNew\",\"jsChildren\":[{\"jsChildId\":136,\"jsChildType\":\"JsInput\"},{\"jsChildId\":137,\"jsChildType\":\"JsOutput\"}],\"jsParent\":{\"jsParentId\":111,\"jsParentType\":\"JsCall\"},\"jsLabel\":\"isEven\"}","{\"jsId\":127,\"jsType\":\"JsNew\",\"jsChildren\":[{\"jsChildId\":132,\"jsChildType\":\"JsInput\"},{\"jsChildId\":134,\"jsChildType\":\"JsInput\"},{\"jsChildId\":135,\"jsChildType\":\"JsOutput\"}],\"jsParent\":{\"jsParentId\":111,\"jsParentType\":\"JsCall\"},\"jsLabel\":\"minus\"}","{\"jsId\":132,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":127,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"2\"}","{\"jsId\":134,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":129,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"1\"}","{\"jsId\":135,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":129,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"1\"}","{\"jsId\":136,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":124,\"jsParentType\":\"JsInput\"},\"jsLabel\":\"1\"}","{\"jsId\":137,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":124,\"jsParentType\":\"JsOutput\"},\"jsLabel\":\"False\"}","{\"jsId\":138,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":111,\"jsParentType\":\"JsOutput\"},\"jsLabel\":\"False\"}","{\"jsId\":139,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":98,\"jsParentType\":\"JsOutput\"},\"jsLabel\":\"False\"}","{\"jsId\":140,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":85,\"jsParentType\":\"JsOutput\"},\"jsLabel\":\"False\"}","{\"jsId\":141,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":81,\"jsParentType\":\"JsOutput\"},\"jsLabel\":\"False\"}","{\"jsId\":142,\"jsType\":\"JsUpd\",\"jsChildren\":[],\"jsParent\":{\"jsParentId\":5,\"jsParentType\":\"JsOutput\"},\"jsLabel\":\"False\"}"];
    var nevent = 0; // start at 0
    var nevents = events.length; 
    
    var lightRed = '#E06240';
    var darkRed = '#76230D';
    var lightBlue = '#40A6E0';
    var darkBlue = '#095F90';
    var lightPurple = '#8019E8';
    var lightYellow = '#F9EA68';
    var darkYellow = '#908204';
    
    function stepForward() {
        if (nevent < nevents)
        {
            var json = JSON.parse(events[nevent]);
            switch (json.jsType)
            {
                case "JsNew":
                    var jslabel = json.jsLabel;
                    var node;
                    if (!json.jsLabel)
                    {
                        node = {id: json.jsId, label: "?", fulllabel: "?", shape:'circle', color:lighRed, font: {color:darkRed} };
                    }
                    else
                    {
                        node = {id: json.jsId, label: trimLabel(jslabel), fulllabel: jslabel, shape:'box', color:lightBlue, font: {color:darkBlue} };
                    }
                    if (nevent==0)
                    {
                        nodes.add(node);
                    }
                    else
                    {
                        nodes.update([node]);
                    }
                    json.jsChildren.forEach(function(child,index) {
                        nodes.add({id: child.jsChildId, label: "?", fulllabel: "?", shape:'circle', color:lightRed, font: {color:darkRed} });
                        switch (child.jsChildType)
                        {
                            case "JsInput":
                                edges.add({id: eid, to: child.jsChildId, from: json.jsId, dashes:true, label: "arg"+(index+1), font: {color:darkBlue}, color:{color:darkBlue, opacity:0.7}, arrows: {from: {enabled:true}, to: {enabled:false}} });
                                break;
                            case "JsOutput":
                                edges.add({id: eid, to: child.jsChildId, from:json.jsId, dashes:true, label:"=",  font: {color:darkBlue}, color:{color:darkBlue, opacity:0.7}});
                                break;
                        }
                    });
                    
                    var jsparent = json.jsParent;
                    if (jsparent)
                    {
                        var eid = json.jsId + "+" + json.jsParent.jsParentId;
                        switch (jsparent.jsParentType)
                        {
                            case "JsCall": 
                                edges.add({id: eid, from: json.jsParent.jsParentId, to:json.jsId, color:darkBlue });
                                break;
                        }
                    }
                    break;
                    
                case "JsUpd":
                    nodes.update([{id: json.jsId, label: trimLabel(json.jsLabel), fulllabel: jslabel, shape:'box', color:lightBlue, font: {color:darkBlue} }]);
                    json.jsChildren.forEach(function(child,index) {
                        nodes.add({id: child.jsChildId, label: "?", fulllabel: "?", shape:'circle', color:lightRed, font: {color:darkRed} });
                        switch (child.jsChildType)
                        {
                            case "JsInput":
                                edges.add({id: eid, to: child.jsChildId, from: json.jsId, dashes:true, label: "arg"+(index+1), font: {color:darkBlue}, color:{color:darkBlue, opacity:0.7}, arrows: {from: {enabled:true}, to: {enabled:false}} });
                                break;
                            case "JsOutput":
                                edges.add({id: eid, to: child.jsChildId, from:json.jsId, dashes:true, label:"=",  font: {color:darkBlue}, color:{color:darkBlue, opacity:0.7}});
                                break;
                        }
                    });
                    break;
            }
            focusLabelForward();
            nevent++; //check this syntax
            drawStatus();
            var duration = Math.round(playspeed*1000);
            var options = {
                    scale: 1,
                    offset: {x:0,y:0},
                animation: { duration: duration }
                  };
            network.focus(json.jsId, options);
        }
    }
    
    function focusLabelForward () {
        var current = JSON.parse(events[nevent]);
        nodes.update([{id: current.jsId, color:lightYellow, font: {color:darkYellow} }]);
        
        if (nevent > 0) {
            var previous = JSON.parse(events[nevent-1]);
            nodes.update([{id: previous.jsId, color:lightBlue, font: {color:darkBlue} }]);
        }
    }
    
    function focusLabelBackward () {
        if (nevent > 0) {
            var previous = JSON.parse(events[nevent-1]);
            nodes.update([{id: previous.jsId, color:lightYellow, font: {color:darkYellow} }]);
        }
    }
    
    function stepBackward () {
        if (nevent > 0)
        {
            nevent--; //check this syntax
            var json = JSON.parse(events[nevent]);
            switch (json.jsType)
            {
                case "JsNew":
                    var jsparent = json.jsParent;
                    if (jsparent)
                    {
                        var eid = json.jsId + "+" + json.jsParent.jsParentId;
                        edges.remove({id: eid});
                    }
                    if (nevent==0 || json.jsParent.jsParentType=="JsCall")
                    {
                        nodes.remove({id: json.jsId});
                    }
                    else
                    {
                        nodes.update([{id: json.jsId, label: "?", fulllabel: "?", color:lightRed, font: {color:darkRed} }]);
                    }
                    json.jsChildren.forEach(function(child) {
                        switch (child.jsChildType)
                        {
                            case "JsInput": 
                                nodes.remove({id:child.jsChildId});
                                break;
                            case "JsOutput": 
                                nodes.remove({id:child.jsChildId});
                                break;
                        }
                    });
                    break;
                    
                case "JsUpd":
                    nodes.update([{id: json.jsId, label: "?", fulllabel: "?", color:lightRed, font: {color:darkRed} }]);
                    json.jsChildren.forEach(function(child) {
                        switch (child.jsChildType)
                        {
                            case "JsInput": 
                                nodes.remove({id:child.jsChildId});
                                break;
                            case "JsOutput": 
                                nodes.remove({id:child.jsChildId});
                                break;
                        }
                    });
                    break;
            }
            drawStatus();
            focusLabelBackward();
            if (nevent > 0) {
                var json = JSON.parse(events[nevent-1]);
                var duration = Math.round(playspeed*1000);
                var options = {
                        scale: 1,
                        offset: {x:0,y:0},
                    animation: { duration: duration }
                      };
                network.focus(json.jsId, options);
            }
        }
    }
    
    function restart() {
        destroy();
        nodesArray = [];
        edgesArray = [];
        draw();
        nevent = 0;
        drawStatus();
    }

    function play() {
        var duration = Math.round(playspeed*1000);
        setIntervalX(stepForward,duration,nevents-nevent);
    }
    
    function stop() {
        window.clearInterval(playIntervalID);
    }
    
    function destroy() {
      if (network !== null) {
        network.destroy();
        network = null;
      }
    }

    function drawStatus() {
        document.getElementById("status").innerHTML = "Event " + nevent + "/" + nevents;
        
        var isFwd = nevent < nevents;
        document.getElementById("fwd").disabled = !isFwd;
        var isBwd = nevent > 0;
        document.getElementById("bwd").disabled = !isBwd;
    }

    function draw() {
      nodes = new vis.DataSet(nodesArray);
      edges = new vis.DataSet(edgesArray);

      // create a network
      var container = document.getElementById('network');
      var data = {
        nodes: nodes,
        edges: edges
      };

      var options = {
        layout: {
          hierarchical: {
            sortMethod: layoutMethod
          }
        },
        edges: {
          smooth: true,
          arrows: {to : true }
        }
      };
      network = new vis.Network(container, data, options);
      
      network.on("selectNode", function (params) {
          params.nodes.forEach(function(nodeId) {
              node = nodes.get(nodeId);
              nodes.update({id:nodeId, label: node.fulllabel});
          });
      });
      network.on("deselectNode", function (params) {
          params.previousSelection.nodes.forEach(function(nodeId) {
              node = nodes.get(nodeId);
              nodes.update({id:nodeId, label: trimLabel(node.fulllabel)});
          });
      });
    }
    
    function setIntervalX(callback, delay, repetitions) {
        var x = 0;
        playIntervalID = window.setInterval(function () {

           callback();

           if (++x === repetitions) {
               window.clearInterval(playIntervalID);
           }
        }, delay);
    }
    function trimLabel(string) {
        var length = 10;
        var trimmedString = string.length > length ? 
                            string.substring(0, length - 3) + "..." : 
                            string;
        return trimmedString;
    }

    function updatePlaySpeed() {
        playspeed = document.getElementById("playspeed").value;
        document.getElementById("playspeedval").innerHTML=playspeed;
    }

  </script>
  
</head>

<body>

<div id="network" style="width: 100vw; height:85vh;"></div>

<button id="fwd" type="button" onclick="stepForward()">Step Forward</button>
<button id="bwd" type="button" onclick="stepBackward()">Step Backward</button>
<button id="restart" type="button" onclick="restart()">Restart</button>
<button id="play" type="button" onclick="play()">Play</button>
<button id="stop" type="button" onclick="stop()">Stop</button>

<br/>

<label for="playspeed">Play Speed</label>
<input type="range" id="playspeed" name="playspeed" step="0.1" min="0" max="2" value="1" oninput="updatePlaySpeed()" onchange="updatePlaySpeed()"/>
<span id=playspeedval>1</span>
<span>(seconds/event)</span>

<pre id="status">
</pre>

</body>

<script>
    draw();
    drawStatus();
</script>

</html>


